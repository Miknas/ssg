
<div class="container-flud">
  <div class="row-fluid">
    <% if flash[:info] %>
      <div class="alert alert-info" style="width: 400px;">
          <a class="close" data-dismiss="alert" href="#">×</a> <%= flash[:info] %>
      </div>
    <% end %>    
    <% if flash[:error] %>
      <div class="alert alert-error" style="width: 600px;">
          <a class="close" data-dismiss="alert" href="#">×</a> <%= flash[:error] %>
      </div>
    <% end %>
  </div>
  <div class="row-fluid">
    <div class="span4">
      <%= form_tag create_or_edit_ssg_admin_categories_path, { :id => "mainForm", :class => "form-horizontal form-cover form-cover-category-create"} do %>
      <!--
      <form id="mainForm" class="form-horizontal form-cover form-cover-create">
        
      -->
        <input type="hidden" name="category_id">
        <div class="control-group">
          <label class="control-label" for="inputName">Ime</label>
          <div class="controls">
            <input type="text" id="inputName" name="category_name" placeholder="Ime Kategorije">
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="inputParentCat">Glavna Kategorija</label>
          <div class="controls">
            <select id="inputParentCat" name="parent_category_id">
              <% @parent_categories.each do |p_cat| %>
                <option value="<%= p_cat.id ? p_cat.id : 0 %>"><%= p_cat.name %></option>
              <% end %> 
            </select>
          </div>
        </div>    
        <div class="control-group">
          <label class="control-label" for="inputDesc">Opis</label>
          <div class="controls">
            <textarea id="inputDesc" name="description" placeholder="Opis"></textarea>
          </div>
        </div>       
        <div class="control-group">
          <label class="control-label" for="inputColor">Boja</label>
          <div class="controls">
            <input type="text" id="inputColor" name="color" placeholder="Boja">
          </div>
        </div>
        <br />
        <br />
        <div class="btn-toolbar" style="text-align: center; margin-left: 80px;">
          <div class="btn-group">
              <button id="btn_create" class="btn btn-primary" type="submit" >Kreiraj</button>
              <button id="btn_edit" class="btn btn-primary" type="submit" disabled>Ažuriraj</button>
          </div>
          <button class="btn btn-warning" onclick="resetForm();" type="button">Reset</button>
        </div> 
      <% end %>
    </div>
    <div class="span8">
      <div class="form-cover form-cover-category-list">
        <table class="table table-bordered" width="600px;">
          <thead>
            <tr>
              <th>#</th>
              <th>Naziv</th>
              <th>Glavna Kategorija</th>
              <th>Opis</th>
              <th>Boja</th>
              <th>Kontrole</th>
            </tr>
          </thead>
          <tbody>
            <% @categories.each do |category| %>
            <tr id="<%= "row_#{category.id}" %>">
              <td><%= category.id %></td>
              <td><%= category.name %></td>
              <td><%= category.parent ? category.parent.name : 'Glavna Kategorija' %></td>
              <td style="max-width:150px;"><%= truncate(category.description, :length => 200) %></td>
              <td style="background-color: #<%= category.color %>; "><b><%= category.color %></b></td>
              <td>
                <div class="btn-toolbar" style="text-align: center;">
                  <div class="btn-group">
                    <a onclick="populateForm(<%=category.id%>,<%= category.parent ? category.parent.id : 0 %>);">
                      <button class="btn-tiny btn-primary">Ažuriraj</button>
                    </a>
                    <a href="<%= ssg_admin_category_path(category.id) %>" data-confirm="Da li ste sigurni?" data-method="delete" rel="nofollow">
                      <button class="btn-tiny btn-danger">Obriši</button>
                    </a>
                  </div>
                </div> 
              </td>
            </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  
  FormValues = ['category_id','category_name','parent_category','description', 'color'];

  enableCreateBtn = function(flag) {
    $('#btn_create').prop('disabled', !flag);
    $('#btn_edit').prop('disabled', flag);
  };

  populateForm = function(id, parent_id) {
    values = $('#row_' + id + ' td');
    // set values to  form
    var el;
    $.each(values, function(i, v) {
      el = $("[name='" + FormValues[i] + "']");
      if (el.is("select")) {
        el.val(parent_id);
      } else {
        el.val(v.textContent);
      }
    });

    enableCreateBtn(false);
    window.scrollTo(0, 0);
  };

  resetForm = function() {
    var el;
    $.each(FormValues, function(i,v) {
      el = $("[name='" + FormValues[i] + "']");
      if (el.is("select")) {
        el.val('0');
      } else {
        el.val('');
      }
    });

    enableCreateBtn(true);
  };

  $(document).ready(function() {
  });
</script>