<div id="issues_right_column" class="font-13" style="clear:right;">
	
	<div class="filter">
		<span class="font-black font-dp-bold">DATE</span><br/>
		<%=link_to 'All time', issues_path(clear_params({:date => nil})), { :class => "#{'r-menu-selected' if params[:date].blank? }"} %><br/>
		<%=link_to 'Today', issues_path(clear_params({:date => :today})), { :class => "#{'r-menu-selected' if params[:date] == 'today' }"} %><br/>
		<%=link_to 'This week', issues_path(clear_params({:date => :week})), { :class => "#{'r-menu-selected' if params[:date] == 'week' }"} %><br/>
		<%=link_to 'This month', issues_path(clear_params({:date => :month})), { :class => "#{'r-menu-selected' if params[:date] == 'month' }"} %><br/>
	</div>
	<div class="filter">
		<span class="font-black font-dp-bold">FEATURED</span><br/>
		<%=link_to 'All time', issues_path(clear_params(:featured => nil)), { :class => "#{'r-menu-selected' if params[:featured].blank? }"} %><br/>
		<%=link_to 'Most viewed', issues_path(clear_params(:featured => :viewed)), { :class => "#{'r-menu-selected' if params[:featured] == 'viewed' }"} %><br/>
		<%=link_to 'Most votes', issues_path(clear_params(:featured => :votes)), { :class => "#{'r-menu-selected' if params[:featured] == 'votes' }"} %><br/>
		<%=link_to 'Most discussed', issues_path(clear_params(:featured => :discussed)), { :class => "#{'r-menu-selected' if params[:featured] == 'discussed' }"} %><br/>
	</div>
	<br style="clear:both;">
	
	<div class="filter">
		<span class="font-black font-dp-bold">CATEGORIES</span><br/>
		<%=link_to 'All categories', issues_path(clear_params({:category => nil})), { :class => "#{'r-menu-selected' if params[:category].blank? }"} %><br/>
		<% User.get_categories.each do |cat|%>
			<%=link_to cat.name, issues_path(clear_params({:category => cat.id})), { :class => "#{'r-menu-selected' if params[:category] == cat.id.to_s }"} %><br/>
		<% end %>
	</div>
	<div class="filter">
		<span class="font-black font-dp-bold">RESOLUTION</span><br/>
		<%=link_to 'All', issues_path(clear_params({:status => nil})), { :class => "#{'r-menu-selected' if params[:status].blank? }"} %><br/>
		<%=link_to 'Open', issues_path(clear_params({:status => Issue::OPEN})), { :class => "#{'r-menu-selected' if params[:status] == Issue::OPEN.to_s }"} %><br/>
		<%=link_to 'In progress', issues_path(clear_params({:status => Issue::IN_PROGRESS})), { :class => "#{'r-menu-selected' if params[:status] == Issue::IN_PROGRESS.to_s }"} %><br/>
		<%=link_to 'Fixed', issues_path(clear_params({:status => Issue::FIXED})), { :class => "#{'r-menu-selected' if params[:status] == Issue::FIXED.to_s }"} %><br/>
	</div>

	<br style="clear:both;">
	
	<div class="filter">
		<span class="font-black font-dp-bold">CITIES</span><br/>
		<input type="text" id="cities_search" />
	</div>
	
</div>

<div style="clear:both;"></div>

<script>
	var __cities = <%=City.for_search.to_json(:only => [:id, :name], :methods => [:friendly_id_link]).html_safe%>;
	$(document).ready(function() {
		$('#cities_search').autocomplete({
			source : function(request, callback){
				var text = $('#cities_search').val();
				var matcher = new RegExp('\\b' + text, 'i') ;
				var responses = $.grep(__cities, function(value) {
					return matcher.test(value.name);
				}).slice(0, 100);
				callback(responses);
			},
			change: function( event, ui ) {
				if ( !ui.item ) {
					var matcher = new RegExp('\\b' + text, 'i') ;
						valid = false;
					select.children( "option" ).each(function() {
						if ( $( this ).text().match( matcher ) ) {
							this.selected = valid = true;
							return false;
						}
					});
					if ( !valid ) {
						// remove invalid value, as it didn't match anything
						$( this ).val( "" );
						select.val( "" );
						input.data( "autocomplete" ).term = "";
						return false;
					}
				}
			},
			select : function( event, ui ) {
				window.location.href = "cities/" + ui.item.friendly_id_link;
			}		
		}).data( "autocomplete" )._renderItem = function( ul, item ) {
			return $( "<li></li>" )
				.data( "item.autocomplete", item )
				.append( "<a>" + item.name)
				.appendTo( ul );
		};
	});
</script>