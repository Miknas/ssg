
<div style="position:relative;">
	<div id="form-div" style="position:absolute; z-index:1000; left:30px; background-color:#9ecc3a; height:490px; width:350px; padding:30px;">
		<span class="font-dp-bold" style="font-size:26px; color:white;">REPORT A PROBLEM</span><br/>
		<span style="color:white;">Click on map to set location</span><br/>
		
		<%= form_for @issue, :html => { :multipart => true, :id => 'fileupload' }  do |f|%>
			<table style="width:340px;">
				<tr >
					<td colspan="2">
						<%= f.text_field :title, :style => 'width:100%;' %>
					</td>
				</tr>
				<tr>
					<td>
						<%= f.collection_select(:city_id, User.get_cities, :id, :name) %>
					</td>
				</tr>
				<tr>
					<td>
						<%= f.collection_select(:category_id, User.get_categories, :id, :name) %>
					</td>
				</tr>
				<tr>
					<td colspan="2">
						<%= f.text_area :description, :style => 'width:100%; height:80px;' %>
					</td>
				</tr>
				<tr>
					<td>
						<input id="fileupload" type="file" name="image" multiple/>
						<span id="gallery_inputs">
							<input type="hidden" id="image_count" name="image_count" value="0" />
						</span>
             	</td>
				</tr>
				<tr>
					<td>
						<div id="progress" style="width:0%; height:5px; background-color:white; margin-bottom:15px;"></div>
						<ul id="gallery" style="list-style:none">
						</ul>
					</td>
				</tr>
				<tr>
					<td>
						<%= f.submit %>
					</td>
				</tr>
			</table>
		<% end %>

	</div>
	
	
	<div id="map" style="height:550px;">
		
	</div>
</div>

<script>
$(function () {

	// MAP

	// initialize the map on the "map" div
	map = new L.Map('map');

	// create a CloudMade tile layer with style #997 (or use other provider of your choice)
	var cloudmade = new L.TileLayer('http://{s}.tile.cloudmade.com/10a3c88ad1f14f18a611c6ebc2300e35/997/256/{z}/{x}/{y}.png', {
	    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
	    maxZoom: 18
	});

	// add the CloudMade layer to the map set the view to a given center and zoom
	map.addLayer(cloudmade).setView(new L.LatLng(43.855078, 18.395748), 13);


	// UPLOAD SETUP
	$('#fileupload').fileupload({
		url : '<%= images_path()%>',
		progressall : function(e, data) {
			$('#progress').css('width',  parseInt(data.loaded / data.total * 100, 10) + '%');
		},
		success : function() {
			$('#progress').css('width', '0%');
		},
		fail : function() {
			alert("Error during upload. Please refresh your browser and try again!!!");
		}
	});

	// VALIDATE
	$('#fileupload').validate({
		rules : {
			issue_title :  {
				required : true
			}
		}
	});
});	
</script>

